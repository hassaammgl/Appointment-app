<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png" />
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png" />
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png" />
    <link rel="manifest" href="/site.webmanifest" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>SmartVisitors</title>
    <script
      src="https://cdn.onesignal.com/sdks/web/v16/OneSignalSDK.page.js"
      defer
    ></script>
    <script>
      import axios from "axios";

      const axiosInstance = axios.create({
        baseURL: import.meta.env.VITE_API_URL || "https://sapps.site/api/",
        withCredentials: true,
      });

      window.OneSignalDeferred = window.OneSignalDeferred || [];
      OneSignalDeferred.push(async function (OneSignal) {
        await OneSignal.init({
          appId: "acd308c2-485f-463c-8c08-93c66ef34608",
          safari_web_id: "web.onesignal.auto.21fd847c-14e1-48c8-a072-78170e2e9023",
          notifyButton: {
            enable: true,
          },
        });

        OneSignal.Slidedown.promptPush();

        OneSignal.User.PushSubscription.addEventListener(
          "change",
          async (event) => {
            if (event.current.id) {
              await axiosInstance.post("/api/auth/save-player-id", {
                userId,
                playerId: event.current.id,
              });
            }
          }
        );
      });
    </script>
  </head>

  <body>
    <div id="root"></div>
    <script type="module" src="/src/main.tsx"></script>
  </body>
</html>
